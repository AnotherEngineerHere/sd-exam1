defaults
   timeout connect 5s
   timeout client 1m
   timeout server 1m

frontend stats
   bind *:1936
   mode http
   stats uri /
   stats show-legends
   no log

frontend http_front
   bind *:80
   mode http
   acl is_micro1 path_beg /micro1
   acl is_micro2 path_beg /micro2
   use_backend micro1_backend if is_micro1
   use_backend micro2_backend if is_micro2
   default_backend default_backend

backend micro1_backend
   mode http
   balance roundrobin
   server micro1-server-1 micro1.service.consul:8080 resolvers consul resolve-prefer ipv4 check

backend micro2_backend
   mode http
   balance roundrobin
   server micro2-server-1 micro2.service.consul:8080 resolvers consul resolve-prefer ipv4 check

backend default_backend
   mode http
   balance roundrobin
   server-template mywebapp 1-10 _web._tcp.service.consul resolvers consul resolve-prefer ipv4 check

resolvers consul
   nameserver consul 127.0.0.1:8600
   accepted_payload_size 8192
   hold valid 5s
